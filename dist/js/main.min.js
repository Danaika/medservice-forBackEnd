"use strict";var currentUserAgent=navigator.userAgent.toLowerCase(),isIphone=-1<currentUserAgent.indexOf("iphone")||-1<currentUserAgent.indexOf("ipad"),isSafari=-1<currentUserAgent.indexOf("safari")&&-1===currentUserAgent.indexOf("win")&&(-1===currentUserAgent.indexOf("mobile")||isIphone);console.log(currentUserAgent,"isSafari",isSafari);var blocks=document.getElementsByClassName("block"),filter=document.getElementsByClassName("filter"),inside_block=document.getElementsByClassName("inside-block"),menu_list=document.getElementsByClassName("menu-list"),content_in=document.getElementsByClassName("content__in"),return_list_item=document.getElementsByClassName("return-list__item");window.onresize=function(){location.reload()};var winowHeight=window.innerHeight,winowWidth=window.innerWidth,container=document.querySelector(".container"),MAIN_PANEL=document.querySelector(".main-panel"),mp_header=document.querySelector(".main-panel__header"),mp_footer=document.querySelector(".main-panel__footer"),mp_menu_list=document.querySelector(".menu-list"),contentEl=document.querySelector(".content"),block_heads=document.querySelector(".block-head"),mainContent_footer=document.querySelector(".mainContent_footer");function getStyle(e,t){return getComputedStyle(e)[t]}var mp_left,mp_h,mp_w,mp_header_h,mp_footer_h,content_h,content_w,block_head_h,mainContent_footer_h,container_pt=getStyle(container,"padding-top"),container_pb=getStyle(container,"padding-bottom"),container_pl=getStyle(container,"padding-left"),container_pr=getStyle(container,"padding-right"),mp_pt=getStyle(MAIN_PANEL,"padding-top"),mp_pb=getStyle(MAIN_PANEL,"padding-bottom"),menu_list_mb=getStyle(mp_menu_list,"margin-bottom"),menu_list_pt=getStyle(mp_menu_list,"padding-top");if(content_h=winowHeight-parseInt(container_pt)-parseInt(container_pb),container.style.height=winowHeight-(parseInt(container_pt)+parseInt(container_pb))+"px",isSafari&&(container.style.height=winowHeight),MAIN_PANEL.style.top=container_pt,mp_h=winowHeight-parseInt(container_pt)-parseInt(container_pb)-parseInt(mp_pt)-parseInt(mp_pb),MAIN_PANEL.style.height=mp_h+"px",content_w=winowWidth-(mp_w=MAIN_PANEL.clientWidth)-parseInt(container_pl)-parseInt(container_pr),860<parseInt(content_w)&&(content_w=860),mp_left=winowWidth/2-(parseInt(mp_w)+parseInt(content_w))/2,MAIN_PANEL.style.left=mp_left+"px",mp_header_h=mp_header.clientHeight,mp_footer_h=mp_footer.clientHeight,mp_menu_list.style.height=parseInt(mp_h)-parseInt(mp_header_h)-parseInt(mp_footer_h)-parseInt(menu_list_mb)-parseInt(menu_list_pt)+"px",contentEl.style.height=content_h+"px",contentEl.style.width=content_w+"px",contentEl.style.top=""+container_pt,contentEl.style.left=mp_left+mp_w+"px",block_head_h=block_heads.clientHeight,mainContent_footer_h=mainContent_footer.clientHeight,mainContent_footer.style.right=parseInt(container_pr)+"px",mainContent_footer.style.bottom=parseInt(container_pb)+"px",mainContent_footer.style.width=content_w+"px",console.log(content_w),1024<=window.innerWidth){var containerBox=container.getBoundingClientRect(),contentBox=contentEl.getBoundingClientRect();mainContent_footer.style.right=containerBox.right-contentBox.right+"px",mainContent_footer.style.bottom=containerBox.bottom-contentBox.bottom+"px",isSafari&&(mainContent_footer.style.bottom=parseInt(container_pb)+"px")}if(window.innerWidth<=1023&&(contentEl.style.height=content_h-56+"px",MAIN_PANEL.classList.contains("folded")?MAIN_PANEL.style.height=winowHeight-parseInt(container_pt)-parseInt(container_pb)-parseInt(mp_pt)-parseInt(mp_pb)+"px":MAIN_PANEL.style.height="auto",contentEl.addEventListener("click",function(e){MAIN_PANEL.classList.contains("folded")||(MAIN_PANEL.style.height="auto")}),contentEl.style.left=parseInt(container_pl)+"px",contentEl.style.width=winowWidth-parseInt(container_pl)-parseInt(container_pr)+"px",document.querySelector(".mob-menu").addEventListener("click",function(e){mp_header_h=mp_header.clientHeight,mp_footer_h=mp_footer.clientHeight,mp_footer_h=46,mp_pt=35,mp_pb=33,mp_h=winowHeight-parseInt(container_pt)-parseInt(container_pb)-parseInt(mp_pt)-parseInt(mp_pb),MAIN_PANEL.style.height=mp_h+"px",mp_menu_list.style.height=mp_h-parseInt(mp_header_h)-parseInt(mp_footer_h)-parseInt(menu_list_mb)-parseInt(menu_list_pt)+"px",console.log("mp_h ="+mp_h),console.log("mp_header_h ="+mp_header_h),console.log("mp_footer_h ="+mp_footer_h),console.log("menu_list_mb ="+menu_list_mb),console.log("menu_list_pt ="+menu_list_pt)})),isSafari){for(var i=0;i<menu_list.length;i++)menu_list[i].style.display="-webkit-box";for(var _i=0;_i<content_in.length;_i++)content_in[_i].style.display="-webkit-box";for(i=0;i<return_list_item.length;i++)return_list_item[i].style.display="-webkit-box";if(1023<=window.innerWidth){for(var _i2=0;_i2<blocks.length;_i2++)blocks[_i2].style.display="-webkit-inline-flex";block_heads.style.display="-webkit-inline-flex";for(var _i3=0;_i3<inside_block.length;_i3++)inside_block[_i3].style.display="-webkit-flex";for(var _i4=0;_i4<filter.length;_i4++)filter[_i4].style.height="40px"}if(834<window.innerWidth&&window.innerWidth<=1112){for(var _i5=0;_i5<blocks.length;_i5++)blocks[_i5].style.display="-webkit-inline-flex";MAIN_PANEL.style.width=+parseInt(mp_w)+"px",contentEl.style.width=content_w+0+"px",contentEl.style.left=+(parseInt(mp_left)+parseInt(mp_w))+"px"}if(1023<=window.innerWidth&&window.innerWidth<=912){block_heads.style.display="-webkit-inline-flex";for(var _i7=0;_i7<inside_block.length;_i7++)inside_block[_i7].style.display="-webkit-inline-flex";for(var _i8=0;_i8<filter.length;_i8++)filter[_i8].style.height="40px"}if(window.innerWidth<=1023&&(block_heads.style.display="-webkit-box"),1023<=window.innerWidth&&window.innerWidth<=1300)for(var cols=document.getElementsByClassName("col"),n=0;n<cols.length;n++){setWebkitFlex(item=cols[n])}if(window.innerWidth<=834)for(var _i9=0;_i9<filter.length;_i9++)filter[_i9].style.display="-webkit-flex"}function setWebkitFlex(e){e.style.display="-webkit-flex"}var measureUnits,drugsReleaseForms,createProtocolBtn=document.querySelector("#createProtocolBtn"),createProtocolTempate=document.querySelector("#createProtocolDialog").innerHTML,saveProtocolBtn=document.querySelector("#saveProtocolBtn"),saveProtocolDialog=document.querySelector("#saveProtocolDialog").innerHTML,addRecomendBtn=document.querySelector("#addRecomend"),addRecomendTempate=document.querySelector("#addRecomendDialog").innerHTML,template=document.querySelector("#modal-template").innerHTML,dialogSimpleTemplate=document.querySelector("#dialogSimpleTemplate").innerHTML;function saveProtocolDialogShow(){showCreateDialog(prepareTemplate(dialogSimpleTemplate,"Протокол № 1234 успешно сохранен","large"))}function deliverySuccessDialogShow(){showCreateDialog(prepareTemplate(dialogSimpleTemplate,"Доставка оформлена",""))}function createProtocolDialogShow(){showCreateDialog(prepareTemplate(dialogSimpleTemplate,"Протокол успешно синхронизирован со страницей пациента","synch"))}function addNewRecomend(){console.log("Add New Recomend!!!")}function createDialog(e){var n=document.createElement("div");n.className="popup",n.innerHTML=template;var t=n.querySelector(".overlay");t.classList.add("dialog--flex-display"),n.querySelector(".popup__container").innerHTML=e;var o=n.querySelector("#cancel");o&&o.addEventListener("click",function(e){document.body.removeChild(n)});var i=n.querySelector("#create");return t.addEventListener("click",function(e){e.target===t&&document.body.removeChild(n)}),{container:n,open:function(){document.body.appendChild(n)},close:function(){document.body.removeChild(n)},setAction:function(t){i&&i.addEventListener("click",function(e){document.body.removeChild(n),t&&t()})}}}function prepareTemplate(e,t,n){var o=document.createElement("div");o.innerHTML=e,o.querySelector(".dial-window__text").textContent=t,n&&o.querySelector(".dial-window--simple").classList.add(n);return o.innerHTML}function showCreateDialog(e,t){var n=createDialog(e,t);return n.open(),n.setAction(t),n}saveProtocolBtn.addEventListener("click",function(e){return showCreateDialog(saveProtocolDialog,saveProtocolDialogShow)}),createProtocolBtn.addEventListener("click",function(e){var o=showCreateDialog(createProtocolTempate,saveProtocolDialogShow);o.container.querySelectorAll("input[name=radio]").forEach(function(n){n.addEventListener("change",function(e){var t=n.closest(".dial-layer");o.container.querySelector(".dial-layer.active").classList.remove("active"),t.classList.add("active")})}),document.querySelectorAll(".drop-list__input").forEach(function(n){var o=n.closest(".drop-list");n.addEventListener("focus",function(e){o.classList.add("active")}),n.addEventListener("blur",function(e){setTimeout(function(){},200)}),o.querySelector(".drop-list__res").addEventListener("click",function(e){if("UL"!==e.target.tagName){var t="SPAN"===e.target.tagName?e.target:e.target.querySelector("span");n.value=t.innerHTML,o.classList.remove("active")}})});var t=o.container.querySelector("#btn-sync");o.container.querySelector("#btn-assign").addEventListener("click",function(e){o.close(),createProtocolDialogShow()}),t.addEventListener("click",function(e){o.close(),deliverySuccessDialogShow()})}),addRecomendBtn.addEventListener("click",function(e){var t=showCreateDialog(addRecomendTempate,addNewRecomend).container,n=t.querySelector(".textarea-field"),o=t.querySelector(".overlay");n.addEventListener("focus",function(){if(window.innerWidth<=1024){var e=window.innerWidth<=768&&425<window.innerWidth?"180px":"50px";o.style.paddingTop=e,o.style.alignItems="flex-start"}})});var addNewDrugBtn=document.querySelector("#addNewDrug"),addNewDrugTemplate=document.querySelector("#addNewDrugTemplate").innerHTML;function addNewDrug(){console.log("Add New Drug!!!"),showCreateDialog(prepareTemplate(dialogSimpleTemplate,"Препарат успешно добавлен",""))}function togleActiveClass(e){if(e.classList.contains("active"))return e.classList.remove("active"),!1;var t=e.parentNode.querySelector(".active");t&&t.classList.remove("active"),e.classList.add("active")}function togleActiveClass_drugs(e){if(e.classList.contains("active"))return e.classList.remove("active"),removeActiveSrc(e),!1;var t=e.parentNode.querySelector(".active");t&&(t.classList.remove("active"),removeActiveSrc(t)),e.classList.add("active"),setActiveSrc(e)}function setActiveSrc(e){var t=e.querySelector("use"),n=t.getAttribute("xlink:href");-1<n.indexOf("_hover")?n=n.replace("_hover","_active"):n+="_active",t.setAttribute("xlink:href",n)}function removeActiveSrc(e){if(!e.classList.contains("active")){var t=e.querySelector("use"),n=t.getAttribute("xlink:href");n=n.replace("_active","_hover"),t.setAttribute("xlink:href",n)}}function toggleHoverClass(e,t){if(!e.classList.contains("active")){var n=e.querySelector("use"),o=n.getAttribute("xlink:href");"over"===t?o=o.replace("_hover",""):o+="_hover",n.setAttribute("xlink:href",o)}}function measureUnitsHandler(e){e.addEventListener("click",function(){togleActiveClass(e)})}function drugsReleaseFormsHandler(e){e.addEventListener("click",function(){togleActiveClass_drugs(e)}),e.addEventListener("mouseenter",function(){toggleHoverClass(e,"over")}),e.addEventListener("mouseleave",function(){toggleHoverClass(e,"out")})}function createIntervalInput(e){var t=e.getElementsByClassName("button-reg__field")[0],n=e.getElementsByClassName("button-reg__minus")[0],o=e.getElementsByClassName("button-reg__plus")[0],i=parseInt(t.value)||0,r=parseInt(t.getAttribute("increment"))||1;n.addEventListener("click",function(e){i=i-r<0?0:i-r,t.value=i}),o.addEventListener("click",function(e){i+=r,t.value=i}),t.addEventListener("blur",function(e){isNaN(parseInt(t.value))||(i=parseInt(t.value)),t.value=i})}addNewDrugBtn.addEventListener("click",function(e){var t=showCreateDialog(addNewDrugTemplate,addNewDrug).container;if(isSafari){var n=t.querySelector(".input-field__wrap"),o=n.querySelector(".drag-name"),i=getStyle(o,"padding-left"),r=getStyle(o,"padding-right"),l=n.getBoundingClientRect().width-parseInt(i)-parseInt(r);o.style.width="".concat(l,"px")}measureUnits=t.querySelectorAll(".unit");for(var a=0;a<measureUnits.length;a++){measureUnitsHandler(measureUnits[a])}drugsReleaseForms=t.querySelectorAll(".dial-window--drug .drugs");for(var c=0;c<drugsReleaseForms.length;c++){drugsReleaseFormsHandler(drugsReleaseForms[c])}createIntervalInput(document.querySelector(".increment-input--dialog"))});for(var calendar=new CalendarClock(".datetime"),interval=setInterval(function(){return calendar.update()},1e3),buttons=document.querySelectorAll(".btn--setActive"),i1=0;i1<buttons.length;i1++){setActive(item=buttons[i1])}function setActive(t){t.addEventListener("click",function(){if(t.classList.contains("active"))return t.classList.remove("active"),!1;var e=t.parentNode.querySelector("button.active");e&&e.classList.remove("active"),t.classList.add("active")})}for(var protocolsUl=document.querySelector(".menu-list"),protocolsItems=protocolsUl.querySelectorAll(".menu-list__item"),i2=0;i2<protocolsItems.length;i2++){setActiveProtocolHandler(item=protocolsItems[i2])}function setActiveProtocolHandler(n){n.addEventListener("click",function(e){e.preventDefault();var t=protocolsUl.querySelector(".menu-list__item.active");t&&t.classList.remove("active"),n.classList.add("active")})}var protocolsUl_height,searchProtocolsFld=document.getElementById("searchProtocols"),emptyResultsDiv=document.querySelector(".isEmptyResults"),isLoad=!0;function findProtocolHandler(e,t){return-1===e.querySelector("a").innerHTML.toLowerCase().indexOf(t)?(e.classList.add("hide"),-1):(e.classList.remove("hide"),1)}searchProtocolsFld.addEventListener("focus",function(e){if(window.innerWidth<=1024){isLoad&&(protocolsUl_height=protocolsUl.getBoundingClientRect().height,isLoad=!1);var t=protocolsUl_height-230;protocolsUl.style.height="".concat(t,"px")}}),searchProtocolsFld.addEventListener("blur",function(e){window.innerWidth<=1024&&(protocolsUl.style.height="".concat(protocolsUl_height,"px"))}),searchProtocolsFld.addEventListener("input",function(e){console.log("input");var o=e.target.value.toLowerCase();throttle(function(){for(var e=protocolsUl.querySelectorAll(".menu-list__item"),t=e.length,n=0;n<e.length;n++){t+=findProtocolHandler(e[n],o)}0===t?emptyResultsDiv.classList.remove("hide"):emptyResultsDiv.classList.add("hide")},3e3)()});var protocolBtn=document.querySelector(".btn-protocol"),returnList=document.querySelector(".return-list"),menuList=document.querySelector(".menu-list"),menuList1stChild=menuList.firstElementChild,menuListLi_marginBottom=15;protocolBtn.addEventListener("click",function(e){MAIN_PANEL.classList.add("return-unfold");var t=menuList.getBoundingClientRect(),n=menuList1stChild.getBoundingClientRect(),o=t.height-n.height-menuListLi_marginBottom;returnList.style.height=o+"px",returnList.style.minHeight=o+"px"});var returnBtn=document.querySelector(".btn-return");if(returnBtn.addEventListener("click",function(e){MAIN_PANEL.classList.remove("return-unfold")}),window.innerWidth<=1023){var footer=document.querySelector(".block--footer"),btnRecomendWrap=document.querySelector(".btn-recomend-wrap"),addRecomendsBtn=footer.removeChild(footer.querySelector(".btn-recomend"));btnRecomendWrap.appendChild(addRecomendsBtn)}if(window.innerWidth<1348&&1024<=window.innerWidth)for(blocks=document.querySelectorAll(".block"),i=0;i<blocks.length;i++){var current=blocks[i];if(!current.classList.contains("block-head")&&!current.classList.contains("block--footer")){var leftCol=current.querySelector(".col .block__layer--left"),rightCol=current.querySelector(".col .block__layer--right"),displacedLeft=current.querySelector(".block__layer--center .inside-block:first-child"),displacedRight=current.querySelector(".block__layer--center .inside-block:last-child");leftCol.insertBefore(displacedLeft,leftCol.firstElementChild),rightCol.insertBefore(displacedRight,rightCol.firstElementChild)}}for(var returnItemsList=document.querySelectorAll(".return-list__item"),i4=0;i4<returnItemsList.length;i4++){var item;toggleActiveClassHandler(item=returnItemsList[i4])}function toggleActiveClassHandler(t){t.addEventListener("click",function(e){return togleActiveClass(t)})}var menu_btn=document.querySelector(".mob-menu"),main_panel=document.querySelector(".main-panel"),content=document.querySelector(".content");menu_btn.addEventListener("click",function(e){return main_panel.classList.add("folded")}),content.addEventListener("click",function(e){return main_panel.classList.remove("folded")});var button=document.querySelector("#testModal"),POPUP_TEMPLATE=document.querySelector("#modal-template").innerHTML,popupIndex=1;function createModal(t,n){var o=document.createElement("div");o.className="popup",o.innerHTML=POPUP_TEMPLATE;var e=t.dataset.popupText,i=t.dataset.popupPosition;o.querySelector(".dial-window").classList.add(i),o.querySelector(".dial-window__text").innerHTML=e,o.querySelector(".popup__container").classList.add("pos_abs"),n.classList.contains("main-panel")||(document.querySelector(".main-panel").style.zIndex="0");return o.querySelector("#popupClose").addEventListener("click",function(e){n.removeChild(o),t.classList.remove("hightlight"),document.querySelector(".main-panel").style.zIndex="100",findPopup(++popupIndex)}),o}function showModal(e){var t=e.dataset.popupPosition,n=getClosestParent(e,"popup-wrapper"),o=createModal(e,n);n.appendChild(o);var i=o.querySelector(".popup__container"),r=t.split("-"),l=r[1],a=r[0],c=e.getBoundingClientRect(),s="left"===l?c.left:c.right-i.offsetWidth-10,d="top"===a?c.bottom+35:c.top-i.offsetHeight-50;e.classList.contains("mainContent_footer")&&(s-=20,d+=20),e.classList.add("hightlight"),i.style.left=s+"px",i.style.top=d+"px"}function findPopup(e){var t='[data-popup-index="'+e+'"]',n=document.querySelector(t);if(n){if(window.innerWidth<1024&&3===e)return!1;showModal(n)}}function getClosestParent(e,t){var n=e.parentNode;if(n)for(;n;){if(n.classList.contains(t))return n;n=n.parentNode}}function throttle(e,t){var n,o,i=!1;function r(){if(i)return n=arguments,void(o=this);e.apply(this,arguments),i=!0,setTimeout(function(){i=!1,n&&(r.apply(o,n),n=o=null)},t)}return r}window.addEventListener("DOMContentLoaded",function(e){setTimeout(function(){},500)});